<div class="c-dashboard">

    <div class="c-dashboard__header" fxLayout="column">
        <div fxLayout="row" fxLayoutAlign="center center">
            <mat-icon class="c-dashboard__header__icon">language</mat-icon>
            <span class="c-dashboard__header__title">{{'title' | translate}}</span>
        </div>
        <div fxLayout="row" fxLayoutAlign="center center" class="c-dashboard__header__date">
            <span>{{'lastUpdate' | translate}}</span>
            <span class="c-dashboard__header__date__value">{{lastUpdate$ | async | date:'d-M-yyyy, HH:mm z'}}</span>
        </div>
    </div>

    <div class="c-dashboard__container" *ngIf="viewData$ | async; let viewData; else spinner" fxLayout="column">
        <mat-tab-group (selectedIndexChange)="currentTabIndex = $event" class="c-dashboard__container__tabs">
            <mat-tab label="{{'tabs.summary' | translate}}"></mat-tab>
            <mat-tab label="{{'tabs.charts' | translate}}"></mat-tab>
        </mat-tab-group>
        <!-- Summary -->
        <div *ngIf="currentTabIndex === 0" class="c-dashboard__container__cards" fxLayout="row wrap" fxLayoutAlign="flex-start flex-start">
            <!-- Totales -->
            <mat-card
                class="c-dashboard__container__cards__card"
                *ngFor="let card of viewData?.cards; trackBy: trackByIndex; let last = last"
                fxFlex.xs="100"
                [fxFlex.sm]="'0 1 calc(50% - 20px)'"
                [fxFlex.md]="'0 1 calc(50% - 40px)'"
                [fxFlex]="'0 1 calc(25% - 40px)'"
            >
                <mat-card-header class="c-dashboard__container__cards__card__header">
                    <mat-card-title class="c-dashboard__container__cards__card__header__title">{{ 'cards.' + card?.title | translate}}</mat-card-title>
                </mat-card-header>
                <mat-card-content class="c-dashboard__container__cards__card__content">
                    <span class="c-dashboard__container__cards__card__content__value" [countUp]="card?.value" [options]="countUpOptions" [reanimateOnClick]="false"></span>
                    <div class="c-dashboard__container__cards__card__increment" fxLayout="row">
                        <span>{{(card?.increment < 0 ? 'cards.decrement' : 'cards.increment') | translate}}</span>
                        <div
                            [ngClass]="card?.increment <= 0 || last
                                ?  'c-dashboard__container__cards__card__increment__value--good'
                                : 'c-dashboard__container__cards__card__increment__value--bad'"
                        >
                            <span class="c-dashboard__container__cards__card__increment__value">{{card?.increment > 0 ? '+' : card?.increment < 0 ? '+' : ''}}</span>
                            <span
                                class="c-dashboard__container__cards__card__increment__value"
                                [countUp]="card?.absIncrement" [options]="countUpOptions"
                                [reanimateOnClick]="false">
                            </span>
                        </div>
                        <span>({{card?.percent}}%)</span>
                    </div>
                </mat-card-content>
            </mat-card>
            <!-- Porcentajes -->
            <div fxLayout="row wrap" fxFlex="1 1 auto" fxLayoutAlign="flex-start stretch">
                <mat-card class="c-dashboard__container__cards__card" fxFlex.xs="100" [fxFlex.sm]="'0 1 calc(33.33% - 20px)'" [fxFlex]="'0 1 calc(33.33% - 40px)'">
                    <mat-card-header class="c-dashboard__container__cards__card__header">
                        <mat-card-title class="c-dashboard__container__cards__card__header__title">Casos activos</mat-card-title>
                    </mat-card-header>
                    <mat-card-content class="c-dashboard__container__cards__card__content__today" fxLayout="row wrap" *ngIf="todayData$ | async; let todayData">
                        <div fxFlex="100" fxLayout="row wrap" class="c-dashboard__container__cards__card__content__today__active">
                            <div fxLayout="column" fxFlex="25" fxLayoutAlign="center center">
                                <span [countUp]="todayData?.active" [options]="countUpOptions"></span>
                                <span>( <span [countUp]="todayData?.activePercent" [options]="countUpOptions"></span>% )</span>
                            </div>
                            <div fxLayout="column" fxFlex="75" fxLayoutAlign="center flex-start">
                                <div fxLayout="row wrap" fxFlex="100">
                                    <span>Moderados:</span>
                                    <span>
                                            <span [countUp]="todayData?.moderate" [options]="countUpOptions"></span>
                                            ( <span [countUp]="todayData?.moderatePercent" [options]="countUpOptions"></span>% )
                                        </span>
                                </div>
                                <div fxLayout="row wrap" fxFlex="100">
                                    <span>Críticos:</span>
                                    <span>
                                            <span [countUp]="todayData?.critical" [options]="countUpOptions"></span>
                                            ( <span [countUp]="todayData?.criticalPercent" [options]="countUpOptions"></span>% )
                                        </span>
                                </div>
                            </div>
                        </div>
                    </mat-card-content>
                </mat-card>
                <mat-card class="c-dashboard__container__cards__card" fxFlex.xs="100" [fxFlex.sm]="'0 1 calc(33.33% - 20px)'" [fxFlex]="'0 1 calc(33.33% - 40px)'">
                    <mat-card-header class="c-dashboard__container__cards__card__header">
                        <mat-card-title class="c-dashboard__container__cards__card__header__title">Casos cerrados</mat-card-title>
                    </mat-card-header>
                    <mat-card-content class="c-dashboard__container__cards__card__content__today" fxLayout="row wrap" *ngIf="todayData$ | async; let todayData">
                        <div fxFlex="100" fxLayout="row wrap" class="c-dashboard__container__cards__card__content__today__closed">
                            <div fxLayout="column" fxFlex="25" fxLayoutAlign="center center">
                                <span [countUp]="todayData?.closed" [options]="countUpOptions"></span>
                                <span>( <span [countUp]="todayData?.closedPercent" [options]="countUpOptions"></span>% )</span>
                            </div>
                            <div fxLayout="column" fxFlex="75" fxLayoutAlign="center flex-start">
                                <div fxLayout="row wrap" fxFlex="100">
                                    <span>Recuperados:</span>
                                    <span>
                                            <span [countUp]="todayData?.recovered" [options]="countUpOptions"></span>
                                            ( <span [countUp]="todayData?.recoveredPercent" [options]="countUpOptions"></span>% )
                                        </span>
                                </div>
                                <div fxLayout="row wrap" fxFlex="100">
                                    <span>Muertos:</span>
                                    <span>
                                            <span [countUp]="todayData?.deaths" [options]="countUpOptions"></span>
                                            ( <span [countUp]="todayData?.deathsPercent" [options]="countUpOptions"></span>% )
                                        </span>
                                </div>
                            </div>
                        </div>
                    </mat-card-content>
                </mat-card>
                <mat-card class="c-dashboard__container__cards__card" fxFlex.xs="100" [fxFlex.sm]="'0 1 calc(33.33% - 20px)'" [fxFlex]="'0 1 calc(33.33% - 40px)'">
                    <mat-card-header class="c-dashboard__container__cards__card__header">
                        <mat-card-title class="c-dashboard__container__cards__card__header__title">Más información</mat-card-title>
                    </mat-card-header>
                    <mat-card-content class="c-dashboard__container__cards__card__content__tomorrow" *ngIf="tomorrowData$ | async; let tomorrowData">
                        {{tomorrowData?.propagationIndex}}
                        {{tomorrowData?.cases}}
                        {{tomorrowData?.deaths}}
                        {{tomorrowData?.recovered}}
                        <p>
                            ¿Estamos mejorando? <span>{{tomorrowData?.improving ? 'SI' : 'NO'}}</span>
                        </p>
                    </mat-card-content>
                </mat-card>
            </div>
            <!-- Chart -->
            <covid-daily-increment-chart [historicalData$]="historicalCases$"></covid-daily-increment-chart>
        </div>
        <!-- More details -->
        <covid-charts *ngIf="currentTabIndex === 1" [historical]="historicalCases$" [global]="globalCases$" [literals]="literals$"></covid-charts>
    </div>

</div>

<ng-template #spinner>
    <div class="spinner">
        <mat-progress-spinner class="example-margin" color="accent" mode="indeterminate"></mat-progress-spinner>
    </div>
</ng-template>
