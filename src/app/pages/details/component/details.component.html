<div class="c-details">

    <ng-container *ngIf="viewData$ | async; let viewData; else spinner">
        <div class="c-details__header" fxLayout="column">
            <div fxLayout="row" fxLayoutAlign="center center">
                <img class="c-details__header__flag" [src]="viewData?.cases?.countryInfo?.flag" alt="Country flag">
                <span class="c-details__header__title">{{viewData?.cases?.country | titlecase}}</span>
            </div>
            <div fxLayout="row" fxLayoutAlign="center center" class="c-details__header__date">
                <span>{{'lastUpdate' | translate}}</span>
                <span class="c-details__header__date__value">{{lastUpdate$ | async | date:'d-M-yyyy, HH:mm z'}}</span>
            </div>
        </div>

        <div class="c-details__container" fxLayout="column">
            <mat-tab-group (selectedIndexChange)="currentTabIndex = $event" class="c-details__container__tabs">
                <mat-tab label="{{'tabs.summary' | translate}}"></mat-tab>
                <mat-tab label="{{'tabs.charts' | translate}}"></mat-tab>
            </mat-tab-group>
            <!-- Summary -->
            <div *ngIf="currentTabIndex === 0" class="c-details__container__cards" fxLayout="row wrap" fxLayoutAlign="flex-start flex-start">
                <!-- Totales -->
                <mat-card
                    class="c-details__container__cards__card"
                    *ngFor="let card of viewData?.cards; trackBy: trackByIndex; let last = last"
                    fxFlex.xs="100"
                    [fxFlex.sm]="'0 1 calc(50% - 20px)'"
                    [fxFlex.md]="'0 1 calc(50% - 40px)'"
                    [fxFlex]="'0 1 calc(25% - 40px)'"
                >
                    <mat-card-header class="c-details__container__cards__card__header">
                        <mat-card-title class="c-details__container__cards__card__header__title">{{ 'cards.' + card?.title | translate}}</mat-card-title>
                    </mat-card-header>
                    <mat-card-content class="c-details__container__cards__card__content">
                        <span class="c-details__container__cards__card__content__value" [countUp]="card?.value" [options]="countUpOptions" [reanimateOnClick]="false"></span>
                        <span>{{card?.percent}}%</span>
                        <div class="c-details__container__cards__card__increment">
                            <span>{{(card?.increment < 0 ? 'cards.decrement' : 'cards.increment') | translate}}</span>
                            <div
                                [ngClass]="card?.increment <= 0 || last
                                    ?  'c-details__container__cards__card__increment__value--good'
                                    : 'c-details__container__cards__card__increment__value--bad'"
                            >
                                <span class="c-details__container__cards__card__increment__value">{{card?.increment > 0 ? '+' : card?.increment < 0 ? '+' : ''}}</span>
                                <span class="c-details__container__cards__card__increment__value" [countUp]="card?.absIncrement" [options]="countUpOptions"
                                      [reanimateOnClick]="false">
                                </span>
                            </div>
                        </div>
                    </mat-card-content>
                </mat-card>
                <!-- Porcentajes -->
                <div fxLayout="row wrap" fxFlex="1 1 auto" fxLayoutAlign="flex-start stretch">
                    <mat-card class="c-details__container__cards__card" fxFlex.xs="100" [fxFlex.sm]="'0 1 calc(50% - 20px)'" [fxFlex]="'0 1 calc(50% - 40px)'">
                        <mat-card-header class="c-details__container__cards__card__header">
                            <mat-card-title class="c-details__container__cards__card__header__title">Datos de hoy</mat-card-title>
                        </mat-card-header>
                        <mat-card-content class="c-details__container__cards__card__content" fxLayout="row wrap" *ngIf="todayData$ | async; let todayData">
                            <div fxFlex="50">
                                <span>Activos {{todayData?.active}} ({{todayData?.activePercent}}%)</span>
                                <div fxLayout="row">
                                    <span>Estado leve/moderada</span>
                                    <span>{{todayData?.moderate}} ({{todayData?.moderatePercent}}%)</span>
                                </div>
                                <div fxLayout="row">
                                    <span>Estado serio/crítica</span>
                                    <span>{{todayData?.critical}} ({{todayData?.criticalPercent}}%)</span>
                                </div>
                            </div>
                            <div fxFlex="50">
                                <span>Cerrados {{todayData?.closed}} ({{todayData?.closedPercent}}%)</span>
                                <div fxLayout="row">
                                    <span>Recovered </span>
                                    <span>{{todayData?.recovered}} ({{todayData?.recoveredPercent}}%)</span>
                                </div>
                                <div fxLayout="row">
                                    <span>Muertos</span>
                                    <span>{{todayData?.deaths}} ({{todayData?.deathsPercent}}%)</span>
                                </div>
                            </div>
                        </mat-card-content>
                    </mat-card>
                    <mat-card class="c-details__container__cards__card" fxFlex.xs="100" [fxFlex.sm]="'0 1 calc(50% - 20px)'" [fxFlex]="'0 1 calc(50% - 40px)'">
                        <mat-card-header class="c-details__container__cards__card__header">
                            <mat-card-title class="c-details__container__cards__card__header__title">Previsión para mañana</mat-card-title>
                        </mat-card-header>
                        <mat-card-content class="c-details__container__cards__card__content" *ngIf="tomorrowData$ | async; let tomorrowData">
                            {{tomorrowData?.cases}}
                            {{tomorrowData?.deaths}}
                            {{tomorrowData?.recovered}}
                        </mat-card-content>
                    </mat-card>
                </div>
                <!-- Chart -->
                <covid-daily-increment-chart [historicalData$]="historical$"></covid-daily-increment-chart>
            </div>
            <!-- More details -->
            <covid-charts *ngIf="currentTabIndex === 1" [historical]="historical$" [country]="country$" [literals]="literals$"></covid-charts>
        </div>

    </ng-container>

</div>

<ng-template #spinner>
    <div class="spinner">
        <mat-progress-spinner class="example-margin" color="accent" mode="indeterminate"></mat-progress-spinner>
    </div>
</ng-template>
